<!DOCTYPE html>
<html lang="bo">
<head>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-WQ62DL1S2M"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-WQ62DL1S2M');
    </script>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <link rel="icon" type="image/png" href="og.png">

    <title>TibetanKeys | Timer </title> 
    
    <style>
    /* ... your existing CSS starts here ... */
        @font-face { font-family: 'OuChan2'; src: url('Monlam Uni OuChan2.ttf'); }
        @font-face { font-family: 'BodYig'; src: url('Monlam BodYig.ttf'); }

        :root {
            --bg: #010a16;
            --panel: rgba(255, 255, 255, 0.05);
            --accent: #00e676; /* Green for Timer Mode */
            --gold: #d4af37;
            --text: #ffffff;
            --red: #ff4444; 
        }

        /* --- GLOBAL SCROLLBAR KILLER --- */
        ::-webkit-scrollbar { display: none; }
        * { -ms-overflow-style: none; scrollbar-width: none; }

        body {
            margin: 0; padding: 0;
            background: var(--bg); color: var(--text);
            font-family: 'Segoe UI', sans-serif;
            overflow: hidden; /* Prevent Page Scroll */
            height: 100vh;
            display: flex; flex-direction: column;
            user-select: none;
        }

        /* --- NAVIGATION (MATCHING INDEX.HTML) --- */
        nav {
            height: auto; flex-shrink: 0; 
            display: flex; justify-content: center; gap: 40px; padding: 15px 0;
            background: rgba(255, 255, 255, 0.05); backdrop-filter: blur(25px); 
            border-bottom: 1px solid rgba(0, 230, 118, 0.2);
            z-index: 5000;
        }
        nav a { 
            color: rgba(255, 255, 255, 0.8); 
            text-decoration: none; 
            font-size: 14px; /* Matched Index */
            font-weight: 700; 
            text-transform: uppercase; 
            letter-spacing: 2px; /* Matched Index */
            cursor: pointer; 
            transition: 0.3s ease;
        }
        nav a:hover { 
            color: var(--accent); 
            transform: scale(1.15); /* Matched Index Animation */
            text-shadow: 0 0 10px rgba(0, 230, 118, 0.5);
        }
        nav a.active { color: var(--accent); border-bottom: 2px solid var(--accent); }

        /* --- MAIN LAYOUT (FLEXBOX CENTERED) --- */
        .container {
            flex-grow: 1; 
            display: flex; flex-direction: column;
            align-items: center; justify-content: center;
            width: 100%; max-width: 1200px;
            margin: 0 auto; padding: 10px;
            box-sizing: border-box;
        }

        /* --- SETUP PANEL --- */
        #setup-panel {
            background: #0b1624; border: 1px solid var(--accent);
            padding: 40px 60px; border-radius: 20px;
            text-align: center;
            box-shadow: 0 0 40px rgba(0,0,0,0.6);
        }

        .time-presets { display: flex; gap: 10px; margin-bottom: 25px; justify-content: center; }
        .time-btn {
            background: rgba(255,255,255,0.05); border: 1px solid #444; color: #fff;
            padding: 10px 20px; border-radius: 8px; cursor: pointer; font-size: 1rem; transition: 0.3s;
        }
        .time-btn:hover, .time-btn.selected {
            background: var(--accent); color: #000; border-color: var(--accent);
            box-shadow: 0 0 15px rgba(0, 230, 118, 0.4);
        }

        .custom-time-box {
            display: flex; align-items: center; justify-content: center; gap: 10px;
            margin-bottom: 25px; font-size: 1.2rem; color: #888;
        }
        .custom-input {
            width: 70px; padding: 10px; text-align: center;
            background: #050d16; border: 1px solid #333; color: var(--accent);
            font-size: 1.2rem; border-radius: 8px;
        }
        .custom-input:focus { border-color: var(--accent); outline: none; }

        .start-btn {
            background: var(--accent); color: #000; border: none;
            padding: 12px 50px; font-size: 1.2rem; font-weight: 900;
            border-radius: 50px; cursor: pointer; 
            box-shadow: 0 0 20px rgba(0, 230, 118, 0.3);
            transition: 0.3s; animation: pulse-btn 2s infinite;
        }
        .start-btn:hover { transform: scale(1.05); box-shadow: 0 0 40px rgba(0, 230, 118, 0.6); }
        @keyframes pulse-btn { 0% { box-shadow: 0 0 0 0 rgba(0, 230, 118, 0.7); } 70% { box-shadow: 0 0 0 20px rgba(0, 230, 118, 0); } 100% { box-shadow: 0 0 0 0 rgba(0, 230, 118, 0); } }

        /* --- GAME ARENA --- */
        #game-arena { 
            display: none; width: 100%; max-width: 1000px;
            text-align: center;
        }

        .timer-box { 
            font-size: 3rem; font-weight: 900; color: var(--accent); 
            margin-bottom: 10px; font-variant-numeric: tabular-nums; 
        }

        .game-display-area {
            font-family: 'OuChan2', serif; 
            line-height: 2.2; 
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            color: #555; 
            padding: 30px 50px; 
            border-radius: 20px;
            margin-bottom: 15px; 
            text-align: left;
            position: relative; 
            cursor: text;
            box-shadow: inset 0 0 50px rgba(0,0,0,0.6);
            height: 350px; 
            overflow: hidden; 
            scroll-behavior: smooth;
            word-break: normal; white-space: normal;
        }

        .tibetan-word { display: inline-block; white-space: nowrap; margin-right: 2px; vertical-align: bottom; }
        .stack { display: inline-block; position: relative; margin-right: 1px; vertical-align: bottom; }
        
        .stack .ghost-text {
            position: absolute; left: 0; bottom: 0; width: 100%; text-align: center;
            color: var(--gold); text-shadow: 0 0 10px rgba(212, 175, 55, 0.8);
            font-family: 'OuChan2', serif; font-size: inherit; line-height: inherit; 
            white-space: nowrap; pointer-events: none; background: transparent;
        }
        .stack .ghost-text.error { color: var(--red); text-shadow: 0 0 10px rgba(255, 68, 68, 0.8); }
        .stack.current-target { background: rgba(255, 255, 255, 0.05); border-radius: 8px; }
        .correct { color: #fff; text-shadow: 0 0 15px rgba(255, 255, 255, 0.5); } 

        #hidden-input { position: absolute; opacity: 0; top: 0; left: 0; height: 0; width: 0; }

        /* CONTROLS BAR */
        .controls-bar { display: flex; justify-content: flex-end; align-items: center; gap: 15px; width: 100%; }
        .ctrl-btn {
            background: none; border: 2px solid #555; color: #888; padding: 8px 15px;
            border-radius: 50px; font-weight: bold; cursor: pointer; transition: 0.3s; font-size: 0.9rem;
        }
        .ctrl-btn:hover { border-color: var(--accent); color: var(--accent); }
        .ctrl-btn.restart:hover { border-color: var(--red); color: var(--red); }

        /* MODAL */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); z-index: 6000; justify-content: center; align-items: center; }
        .modal-content { background: #0b1624; border: 1px solid var(--accent); padding: 40px; border-radius: 20px; width: 90%; max-width: 500px; text-align: center; }

        @media (max-width: 768px) {
            nav { gap: 15px; padding: 15px 10px; overflow-x: auto; justify-content: flex-start; }
            .container { padding: 5px; }
            .game-display-area { font-size: 28px; padding: 15px; height: 280px; }
            .timer-box { font-size: 2.5rem; }
        }
    </style>
</head>
<body>

    <nav>
        <a href="index.html">Home</a>
        <a href="index.html">About</a>
        <a href="lessons.html">Lessons</a>
        <a href="paper.html">Paper</a> 
        <a href="leaderboard.html">Leaderboard</a>
        <a href="timer.html" class="active">Timer</a>
        <a href="index.html">Install</a>
        <a href="index.html">Contact</a>
        <a href="index.html">Credits</a>
        <a href="index.html">Donate</a>
    </nav>

    <div class="container">
        <div id="setup-panel">
            <h2 style="color:#00e676; margin-bottom:20px; text-transform:uppercase; letter-spacing:2px;">Set Timer</h2>
            <div class="time-presets">
                <button class="time-btn" onclick="selectTime(30)">30s</button>
                <button class="time-btn" onclick="selectTime(60)">1m</button>
                <button class="time-btn selected" onclick="selectTime(120)">2m</button>
                <button class="time-btn" onclick="selectTime(300)">5m</button>
                <button class="time-btn" onclick="selectTime(600)">10m</button>
            </div>

            <div class="custom-time-box">
                <input type="number" id="cust-min" class="custom-input" placeholder="00" min="0" max="60" oninput="clearPresets()"> 
                <span>m :</span>
                <input type="number" id="cust-sec" class="custom-input" placeholder="00" min="0" max="59" oninput="clearPresets()">
                <span>s</span>
            </div>

            <button class="start-btn" onclick="initGame()">START</button>
        </div>

        <div id="game-arena">
            <div class="timer-box" id="timer-display">02:00</div>
            
            <div id="game-display" class="game-display-area" onclick="focusInput()"></div>
            <input type="text" id="hidden-input" autocomplete="off">

            <div class="controls-bar">
                <button class="ctrl-btn" onmousedown="event.preventDefault(); adjustFontSize(-5)">A-</button>
                <button class="ctrl-btn" onmousedown="event.preventDefault(); adjustFontSize(5)">A+</button>
                <div style="flex-grow:1;"></div> 
                <button class="ctrl-btn restart" onclick="restartGame()">RESTART</button>
                <button class="ctrl-btn" onclick="location.reload()" style="border-color:#888;">EXIT</button>
            </div>
        </div>
    </div>

    <div id="result-modal" class="modal">
        <div class="modal-content">
            <h2 style="color:var(--accent);">TIME'S UP!</h2>
            <div style="display:grid; grid-template-columns: 1fr 1fr; gap: 10px; margin: 20px 0; text-align: left;">
                <div>Raw WPM:</div> <div id="res-wpm" style="color:var(--gold); font-weight:bold;">0</div>
                <div>Accuracy:</div> <div id="res-acc" style="color:var(--gold); font-weight:bold;">0%</div>
            </div>
            <div style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 10px; margin-bottom: 20px;">
                <div style="font-size: 0.9rem; color:#888;">FINAL SCORE</div>
                <div id="res-score" style="font-size: 3rem; font-weight:900; color:var(--accent);">0</div>
            </div>
            <button class="start-btn" style="font-size:1rem; padding:10px 30px;" onclick="location.reload()">TRY AGAIN</button>
        </div>
    </div>

    <script>
        // CONFIG
        const NORMAL_MAP = { 'k':'ཀ','t':'ཏ','p':'པ','s':'ས','d':'ད','f':'ང','g':'ག','h':'ཧ','j':'ཇ','l':'ལ','z':'ཟ','x':'ཙ','c':'ཅ','v':'ཌ','b':'བ','n':'ན','m':'མ','q':'ཊ','w':'ཝ','e':'ེ','r':'ར','y':'ཡ','u':'ུ','i':'ི','o':'ོ', '[':'༷',']':'྄','\\':'༔',';':'ཌྷ','\'':'འ',',':'ྱ','.':'ྲ','/':'།','`':'༌','1':'༡','2':'༢','3':'༣','4':'༤','5':'༥','6':'༦','7':'༧','8':'༨','9':'༩','0':'༠','-':'ྀ','=':'ཾ',' ':'་' };
        const SHIFT_MAP = { 'k':'ཁ','t':'ཐ','p':'ཕ','a':'ཨ','s':'ཤ','d':'ཛ','f':'དྷ','g':'གྷ','h':'ྷ','j':'ཛྷ','l':'ླ','z':'ཞ','x':'ཚ','c':'ཆ','v':'ཎ','b':'བྷ','n':'ཉ','m':'ཥ','q':'ཋ','w':'ྭ','e':'ཻ','r':'ཪ','y':'ྱ','u':'ཱུ','i':'ྀ','o':'ཽ', '[':'ྂ',']':'༵','\\':'྅',';':'ཿ','\'':'ཱ',',':'‚','.':'ླ','/':'„','`':'༸','1':'༑','2':'༄༅','3':'༅','4':'“','5':'”','6':'༈','7':'༼','8':'༽','9':'(','0':')','-':'ཱྀ','=':'ྃ',' ':' ', '>': 'ླ' };
        const SUBJOINED_MAP = { 'k':'ྐ', 'g':'ྒ', 'b':'ྦ', 't':'ྟ', 'd':'ྡ', 'z':'ྯ', 'p':'ྤ', 'm':'ྨ', 'n':'ྣ', 'l':'ླ', 's':'ྶ', 'h':'ྷ', 'j':'ྗ', 'c':'ྕ', 'x':'ྩ', 'f':'ྔ', 'q':'ྚ', 'v':'ྜ', 'w':'ྭ', 'r':'ྲ', 'y':'ྱ', '\'':'ཱ' };

        // RANDOM TEXT DATABASE
        const TEXT_DB = [
            "འཛམ་གླིང་གི་ཡང་ཐོག་ཏུ་ཆགས་པའི་ང་ཚོའི་ཕ་ཡུལ་བོད་ལྗོངས་ནི་རི་མཐོ་ས་གཙང་དང་གངས་རི་ར་བས་བསྐོར་བའི་ཡུལ་གྲུ་ཞིག་ཡིན། འདི་ནི་ང་ཚོའི་སྐྱེ་གནས་དང་འཚོ་གནས་ཀྱི་གཞི་རྟེན་ཡིན།",
            "བོད་ཀྱི་སྐད་ཡིག་ནི་ལོ་རྒྱུས་ཡུན་རིང་ལྡན་པའི་རིག་གནས་ཤིག་ཡིན་ལ། ང་ཚོའི་མེས་པོ་ཚོས་བཞག་པའི་རྩ་ཆེའི་ནོར་བུ་ཞིག་ཀྱང་ཡིན། དེ་ནི་ང་ཚོའི་ངོ་བོ་དང་ལ་རྒྱ་མཚོན་བྱེད་ཀྱི་མེ་ལོང་ལྟ་བུ་རེད།",
            "ཤེས་བྱ་ནི་མི་རིགས་ཤིག་གི་མདུན་ལམ་དང་འབྲེལ་བ་དམ་ཟབ་ཡོད། ང་ཚོས་དེང་དུས་ཀྱི་ཤེས་བྱ་གསར་པ་སྦྱོང་དགོས་པ་མ་ཟད། རང་གི་སྲོལ་རྒྱུན་རིག་གནས་ཀྱང་རྒྱུན་འཛིན་བྱེད་དགོས།"
        ];

        let selectedSeconds = 120;
        let timerInterval;
        let timeRemaining = 0;
        let isPlaying = false;
        
        let targetStacks = [];
        let currentStackIndex = 0;
        let currentTyped = "";
        let totalTypedChars = 0;
        let correctKeystrokes = 0;
        let isStackingMode = false;
        let currentFontSize = 48;

        function selectTime(sec) {
            selectedSeconds = sec;
            document.querySelectorAll('.time-btn').forEach(b => b.classList.remove('selected'));
            event.target.classList.add('selected');
            document.getElementById('cust-min').value = "";
            document.getElementById('cust-sec').value = "";
        }

        function clearPresets() {
            document.querySelectorAll('.time-btn').forEach(b => b.classList.remove('selected'));
            selectedSeconds = 0; 
        }

        function initGame() {
            const cMin = parseInt(document.getElementById('cust-min').value) || 0;
            const cSec = parseInt(document.getElementById('cust-sec').value) || 0;
            if (cMin > 0 || cSec > 0) selectedSeconds = (cMin * 60) + cSec;
            if (selectedSeconds <= 0) { alert("Please select a time!"); return; }

            document.getElementById('setup-panel').style.display = 'none';
            document.getElementById('game-arena').style.display = 'block';
            const randomText = TEXT_DB[Math.floor(Math.random() * TEXT_DB.length)];
            startGame(randomText);
        }

        function startGame(rawText) {
            if(timerInterval) clearInterval(timerInterval);
            targetStacks = tokenizeTibetan(rawText);
            
            const display = document.getElementById('game-display');
            display.innerHTML = ''; display.scrollTop = 0;
            display.style.fontSize = currentFontSize + "px";

            let currentWordDiv = document.createElement('span');
            currentWordDiv.className = 'tibetan-word';
            
            targetStacks.forEach((s, i) => {
                let span = document.createElement('span');
                span.innerText = s; span.className = 'stack'; span.id = `stack-${i}`;
                if (i === 0) {
                    span.classList.add('current-target');
                    let ghost = document.createElement('span');
                    ghost.className = 'ghost-text'; ghost.id = 'current-ghost';
                    span.appendChild(ghost);
                }
                currentWordDiv.appendChild(span);
                if (s.includes('་') || s.includes(' ') || i === targetStacks.length - 1) {
                    display.appendChild(currentWordDiv);
                    currentWordDiv = document.createElement('span');
                    currentWordDiv.className = 'tibetan-word';
                }
            });

            currentStackIndex = 0; currentTyped = ""; totalTypedChars = 0; correctKeystrokes = 0;
            isStackingMode = false; isPlaying = false;
            timeRemaining = selectedSeconds;
            updateTimerDisplay();
            
            const ghostInput = document.getElementById('hidden-input');
            ghostInput.onkeydown = null; ghostInput.onkeydown = handleKeydown;
            focusInput();
        }

        function restartGame() {
            const randomText = TEXT_DB[Math.floor(Math.random() * TEXT_DB.length)];
            startGame(randomText);
        }

        function tokenizeTibetan(text) {
            const stacks = []; let current = "";
            const isCombiner = (char) => {
                const code = char.charCodeAt(0);
                return (code >= 0x0F71 && code <= 0x0FBC) || (code === 0x0F35 || code === 0x0F37 || code === 0x0F39);
            };
            for (let char of text) {
                if (current.length === 0) { current += char; } 
                else {
                    if (isCombiner(char)) { current += char; } 
                    else { stacks.push(current); current = char; }
                }
            }
            if(current) stacks.push(current);
            return stacks;
        }

        function handleKeydown(e) {
            if (e.ctrlKey || e.metaKey || e.key === 'Tab' || e.key === 'Enter') { e.preventDefault(); return; }
            if (e.key === 'Backspace') {
                if (currentTyped.length > 0) { currentTyped = currentTyped.slice(0, -1); isStackingMode = false; updateGhostText(false); }
                return;
            }
            if (!isPlaying) { isPlaying = true; timerInterval = setInterval(gameLoop, 1000); }

            const lookupKey = e.key.toLowerCase();
            let tibetanChar = null;

            if (e.key === 'a' && !e.shiftKey) { e.preventDefault(); isStackingMode = true; return; }
            if (isStackingMode) {
                if (SUBJOINED_MAP[lookupKey]) { tibetanChar = SUBJOINED_MAP[lookupKey]; isStackingMode = false; } else { isStackingMode = false; }
            }
            if (!tibetanChar) {
                if (e.shiftKey && e.key === '>') tibetanChar = SHIFT_MAP['>'];
                else if (e.shiftKey) { if (SHIFT_MAP[lookupKey]) tibetanChar = SHIFT_MAP[lookupKey]; } 
                else { if (NORMAL_MAP[lookupKey]) tibetanChar = NORMAL_MAP[lookupKey]; }
            }

            if (tibetanChar) {
                e.preventDefault();
                currentTyped += tibetanChar; totalTypedChars++; checkInput();
            }
        }

        function checkInput() {
            const targetStack = targetStacks[currentStackIndex];
            if (targetStack.startsWith(currentTyped)) {
                updateGhostText(false); correctKeystrokes++;
                if (currentTyped === targetStack) {
                    const span = document.getElementById(`stack-${currentStackIndex}`);
                    span.classList.remove('current-target'); span.classList.add('correct');
                    const oldGhost = document.getElementById('current-ghost'); if(oldGhost) oldGhost.remove();

                    currentStackIndex++;
                    if (currentStackIndex < targetStacks.length) {
                        const nextSpan = document.getElementById(`stack-${currentStackIndex}`);
                        nextSpan.classList.add('current-target');
                        let newGhost = document.createElement('span');
                        newGhost.className = 'ghost-text'; newGhost.id = 'current-ghost';
                        nextSpan.appendChild(newGhost);
                        
                        const container = document.getElementById('game-display');
                        nextSpan.scrollIntoView({block: "center", behavior: "smooth"});

                        currentTyped = ""; isStackingMode = false; updateGhostText(false);
                    } else {
                        finishGame(); 
                    }
                }
            } else { updateGhostText(true); }
        }

        function updateGhostText(isError) {
            const ghost = document.getElementById('current-ghost');
            if(ghost) { ghost.innerText = currentTyped; if(isError) ghost.classList.add('error'); else ghost.classList.remove('error'); }
        }

        function gameLoop() {
            timeRemaining--; updateTimerDisplay();
            if (timeRemaining <= 0) { finishGame(); }
        }

        function updateTimerDisplay() {
            const m = Math.floor(timeRemaining / 60).toString().padStart(2,'0');
            const s = (timeRemaining % 60).toString().padStart(2,'0');
            document.getElementById('timer-display').innerText = `${m}:${s}`;
        }

        function finishGame() {
            clearInterval(timerInterval); isPlaying = false;
            const timeSpent = selectedSeconds - timeRemaining;
            const minutes = timeSpent / 60;
            const wpm = minutes > 0 ? Math.round((totalTypedChars / 5) / minutes) : 0;
            const accuracy = totalTypedChars > 0 ? Math.round((correctKeystrokes / totalTypedChars) * 100) : 0;
            const score = Math.round(wpm * (accuracy / 100));

            document.getElementById('res-wpm').innerText = wpm;
            document.getElementById('res-acc').innerText = accuracy + "%";
            document.getElementById('res-score').innerText = score;
            document.getElementById('result-modal').style.display = 'flex';
        }

        function adjustFontSize(delta) {
            currentFontSize += delta;
            if(currentFontSize < 20) currentFontSize = 20; if(currentFontSize > 80) currentFontSize = 80;
            document.getElementById('game-display').style.fontSize = currentFontSize + "px";
            focusInput();
        }
        function focusInput() { document.getElementById('hidden-input').focus(); }
    </script>
</body>
</html>